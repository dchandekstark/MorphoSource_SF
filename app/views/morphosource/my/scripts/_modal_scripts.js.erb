$('body').on('shown.bs.modal','#pageModal', function (e) {
  // If the button to request an individual item is clicked, add that item's id to an input in the form. Otherwise, collect all the checkboxes that have been selected and create an input for each of those.
  if ($(e.relatedTarget).data('item-id')){
    let item_id = $(e.relatedTarget).data('item-id');
    createHiddenInputs(item_id);
  } else if ($(e.relatedTarget).data('work-id')) {
    let work_id = $(e.relatedTarget).data('work-id')
  } else {
    let item_ids = [];
    $.each($('.batch_document_selector:checked'), function(){
      item_ids.push($(this).val());
    });
    item_ids.forEach(createHiddenInputs);
  }
});

// Adds a new input for each item selected
function createHiddenInputs(id) {
  $('<input>').attr({
    type: 'hidden',
    name: 'batch_document_ids[]',
    value: id
}).appendTo('form');
}

function clearHiddenInputs() {
  var form = $('#modal-form');
  form.find('input[name="batch_document_ids[]"]').remove();
}

$(document).on('turbolinks:load', function(){
  // remove item ids from the form if modal is closed or cancel button is clicked
  $("#modal-cancel, #close-modal").bind('click', function() {
    clearHiddenInputs();
  });
  // remove item ids from the form if modal is closed by clicking outside of the modal
  $('#pageModal').bind('click', function(e) {
    if($(e.target).hasClass('in')) {
      clearHiddenInputs();
    };
  });
});
